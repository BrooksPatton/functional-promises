
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2.5">
    <title>Functional Promises - API Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-112472862-1"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <a href="https://github.com/justsml/functional-promises" target="_blank"><img src="images/logo.png" class="logo" alt="Logo" /></a>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#functional-promises" class="toc-h1 toc-link" data-title="Functional Promises">Functional Promises</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#summary" class="toc-h2 toc-link" data-title="Summary">Summary</a>
                  </li>
                  <li>
                    <a href="#library-comparison" class="toc-h2 toc-link" data-title="Library Comparison">Library Comparison</a>
                  </li>
                  <li>
                    <a href="#api-outline" class="toc-h2 toc-link" data-title="API Outline">API Outline</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#thenable-methods" class="toc-h1 toc-link" data-title="Thenable Methods">Thenable Methods</a>
          </li>
          <li>
            <a href="#160-160-array-methods" class="toc-h1 toc-link" data-title="   Array Methods">   Array Methods</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#code-fp-map-iterable-fn-code" class="toc-h2 toc-link" data-title="<code>FP.map(iterable, fn)</code>"><code>FP.map(iterable, fn)</code></a>
                  </li>
                  <li>
                    <a href="#code-fp-filter-iterable-fn-code" class="toc-h2 toc-link" data-title="<code>FP.filter(iterable, fn)</code>"><code>FP.filter(iterable, fn)</code></a>
                  </li>
                  <li>
                    <a href="#code-fp-find-iterable-fn-code" class="toc-h2 toc-link" data-title="<code>FP.find(iterable, fn)</code>"><code>FP.find(iterable, fn)</code></a>
                  </li>
                  <li>
                    <a href="#code-fp-findindex-iterable-fn-code" class="toc-h2 toc-link" data-title="<code>FP.findIndex(iterable, fn)</code>"><code>FP.findIndex(iterable, fn)</code></a>
                  </li>
                  <li>
                    <a href="#code-fp-some-iterable-fn-code" class="toc-h2 toc-link" data-title="<code>FP.some(iterable, fn)</code>"><code>FP.some(iterable, fn)</code></a>
                  </li>
                  <li>
                    <a href="#code-fp-none-iterable-fn-code" class="toc-h2 toc-link" data-title="<code>FP.none(iterable, fn)</code>"><code>FP.none(iterable, fn)</code></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#160-160-conditional" class="toc-h1 toc-link" data-title="   Conditional">   Conditional</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#code-fp-thenif-code" class="toc-h2 toc-link" data-title="<code>FP.thenIf()</code>"><code>FP.thenIf()</code></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#160-160-utilities" class="toc-h1 toc-link" data-title="   Utilities">   Utilities</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#code-tap-fn-code" class="toc-h2 toc-link" data-title="<code>.tap(fn)</code>"><code>.tap(fn)</code></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#160-160-properties" class="toc-h1 toc-link" data-title="   Properties">   Properties</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#code-fp-get-keyname-code" class="toc-h2 toc-link" data-title="<code>FP.get(keyName)</code>"><code>FP.get(keyName)</code></a>
                  </li>
                  <li>
                    <a href="#code-fp-set-keyname-value-code" class="toc-h2 toc-link" data-title="<code>FP.set(keyName, value)</code>"><code>FP.set(keyName, value)</code></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#specialty-methods" class="toc-h1 toc-link" data-title="Specialty Methods">Specialty Methods</a>
          </li>
          <li>
            <a href="#160-160-helpers" class="toc-h1 toc-link" data-title="   Helpers">   Helpers</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#code-fp-resolve-lt-anything-gt-code" class="toc-h2 toc-link" data-title="<code>FP.resolve(&lt;anything&gt;)</code>"><code>FP.resolve(&lt;anything&gt;)</code></a>
                  </li>
                  <li>
                    <a href="#code-fp-all-code" class="toc-h2 toc-link" data-title="<code>FP.all()</code>"><code>FP.all()</code></a>
                  </li>
                  <li>
                    <a href="#code-fp-unpack-code" class="toc-h2 toc-link" data-title="<code>FP.unpack()</code>"><code>FP.unpack()</code></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#160-160-events" class="toc-h1 toc-link" data-title="   Events">   Events</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#code-listen-code-event-helper" class="toc-h2 toc-link" data-title="<code>.listen()</code> event helper"><code>.listen()</code> event helper</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#160-160-composition-pipelines" class="toc-h1 toc-link" data-title="   Composition Pipelines">   Composition Pipelines</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#code-chain-code-code-chainend-code" class="toc-h2 toc-link" data-title="<code>.chain()</code> / <code>.chainEnd()</code>"><code>.chain()</code> / <code>.chainEnd()</code></a>
                  </li>
                  <li>
                    <a href="#re-usable-promise-chains" class="toc-h2 toc-link" data-title="Re-usable Promise Chains">Re-usable Promise Chains</a>
                  </li>
                  <li>
                    <a href="#events-promise-chain" class="toc-h2 toc-link" data-title="Events + Promise Chain">Events + Promise Chain</a>
                  </li>
                  <li>
                    <a href="#controller-events-promise-chain" class="toc-h2 toc-link" data-title="Controller + Events + Promise Chain">Controller + Events + Promise Chain</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#160-160-modifiers" class="toc-h1 toc-link" data-title="   Modifiers">   Modifiers</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#code-quiet-code" class="toc-h2 toc-link" data-title="<code>.quiet()</code>"><code>.quiet()</code></a>
                  </li>
                  <li>
                    <a href="#code-concurrency-threadlimit-code" class="toc-h2 toc-link" data-title="<code>.concurrency(threadLimit)</code>"><code>.concurrency(threadLimit)</code></a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a class='social github' href='https://github.com/justsml/functional-promises'>Star on GitHub</a></li>
            <li><a class='bottom' target='_blank' href='https://github.com/lord/slate'>Docs Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='functional-promises'>Functional Promises</h1><h6 id='a-href-https-github-com-justsml-functional-promises-view-code-functional-promises-code-on-github-a'><a href="https://github.com/justsml/functional-promises">View <code>Functional Promises</code> on Github</a></h6>
<blockquote>
<p style='text-align: center;'><strong style='font-size: 19px;'>Examples of Awesome Shit</strong></p>

<p>Array-style methods are built-in:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="s1">'1'</span><span class="p">,</span> <span class="s1">'2'</span><span class="p">,</span> <span class="s1">'3'</span><span class="p">,</span> <span class="s1">'4'</span><span class="p">,</span> <span class="s1">'5'</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nb">Number</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
  <span class="p">})</span>

</code></pre>
<blockquote>
<p>Create re-usable sequences of functions with <code>.chain()</code>.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">squareAndFormatDecimal</span> <span class="o">=</span> <span class="nx">FP</span>
  <span class="p">.</span><span class="nx">chain</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">concurrency</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">concurrency</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">chainEnd</span><span class="p">()</span> <span class="c1">// returns function</span>

<span class="nx">squareAndFormatDecimal</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">num</span> <span class="o">=&gt;</span> <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="p">[</span><span class="s1">'25.00'</span><span class="p">,</span> <span class="s1">'100.00'</span><span class="p">,</span> <span class="s1">'400.00'</span><span class="p">]))</span>
</code></pre>
<blockquote>
<p>Use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch"><code>fetch</code></a> with <code>FP.thenIf()</code> to handle <code>response.ok === false</code> with custom response.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Wrap `fetch`'s return Promise with `FP.resolve()` to use `FP`'s methods</span>
<span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/profile'</span><span class="p">,</span> <span class="p">{</span><span class="na">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">}))</span>
  <span class="p">.</span><span class="nx">thenIf</span><span class="p">(</span> <span class="c1">// thenIf lets us handle branching logic</span>
    <span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">,</span> <span class="c1">// Check if response is ok</span>
    <span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span> <span class="c1">// if true, return the parsed body</span>
    <span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">({</span><span class="na">avatar</span><span class="p">:</span> <span class="s1">'/no-photo.svg'</span><span class="p">}))</span> <span class="c1">// fail, use default object</span>
  <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'avatar'</span><span class="p">)</span> <span class="c1">// Get the resulting objects `avatar` value</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">avatarUrl</span> <span class="o">=&gt;</span> <span class="nx">imgElement</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">avatarUrl</span><span class="p">)</span>
</code></pre>
<blockquote>
<p><code>FP.thenIf()</code> replaces the <code>if</code> branching code here:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Non-FP, Native Promises:</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">'/profile'</span><span class="p">,</span> <span class="p">{</span><span class="na">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span><span class="na">avatar</span><span class="p">:</span> <span class="s1">'/no-photo.svg'</span><span class="p">}</span>
     <span class="p">}</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">avatar</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">avatarUrl</span> <span class="o">=&gt;</span> <span class="nx">imgElement</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">avatarUrl</span><span class="p">)</span>
</code></pre>
<p><a href="https://travis-ci.org/justsml/functional-promises"><img src="https://travis-ci.org/justsml/functional-promises.svg?branch=master" alt="Build Status" /></a>
<a href="https://github.com/justsml/functional-promises"><img src="https://img.shields.io/github/package-json/v/justsml/functional-promises.svg?style=flat" alt="GitHub package version" /></a>
<a href="https://github.com/justsml/functional-promises"><img src="https://img.shields.io/github/stars/justsml/functional-promises.svg?label=Stars&amp;style=flat" alt="GitHub stars" /></a></p>
<h3 id='summary'>Summary</h3>
<p><strong>Functional Promises</strong> are an extension of the native Promises API (<code>.then()</code>/<code>.catch()</code>).</p>

<p><strong>Core features:</strong> Array Methods, Events, Object &amp; Array <code>FP.all()</code> Resolution, Re-usable Function Chains, Conditional/Branching Logic, Concurrency, Smart Error Handling.</p>

<p><strong>Why not simply use [library X]?</strong></p>

<ul>
<li>RxJS: <code>FP</code> is 1/5th the size. <em>Observable support still being evaluated.</em></li>
<li>Bluebird: <code>FP</code> adds some key features: <em>events</em>, <em>conditionals</em>, <em>chains</em>, <em>quiet errors</em>. (Disclaimer: I&#39;m a contributor, with a low PR acceptance ratio. 😿)</li>
</ul>

<p><code>FP</code>&#39;s NodeJS source is <strong>only ~300 lines of code.</strong>
The <strong>browser bundle</strong> weighs in at <strong>~30Kb</strong> (using Webpack+Babel+Rollup+UglifyJS).</p>
<h3 id='library-comparison'>Library Comparison</h3>
<table><thead>
<tr>
<th>Library</th>
<th style="text-align: right"># Files</th>
<th style="text-align: right"># Lines Code</th>
<th style="text-align: right"><strong>Browser</strong> Bundle Kb</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Functional Promise v1.4</strong></td>
<td style="text-align: right">8</td>
<td style="text-align: right">376</td>
<td style="text-align: right">30 Kb</td>
</tr>
<tr>
<td><a href="https://github.com/petkaantonov/bluebird">Bluebird</a> v3.5.1</td>
<td style="text-align: right">38</td>
<td style="text-align: right">5188</td>
<td style="text-align: right">80 Kb</td>
</tr>
<tr>
<td><a href="https://github.com/ReactiveX/RxJS">RxJS</a> v5.5.6</td>
<td style="text-align: right">458</td>
<td style="text-align: right">12,266</td>
<td style="text-align: right">150 Kb</td>
</tr>
<tr>
<td><a href="https://github.com/ReactiveX/IxJS">IxJS</a> v2.3.4</td>
<td style="text-align: right">521</td>
<td style="text-align: right">12366</td>
<td style="text-align: right">145 Kb</td>
</tr>
</tbody></table>

<p>So <code>FP</code> is roughly <strong>1/30th</strong> the lines of code in <code>IxJs</code>. And it&#39;s bundle size is almost <strong>1/5th</strong> the size. <code>IxJS</code>/<code>RxJS</code> also feature a far more expansive API.</p>

<p>BluebirdJS and FP have roughly the same number of API methods, yet Bluebird has a fair bit more code to sort through.</p>

<p><b>To be clear:</b> Bluebird, RxJS and IxJS are amazing.</p>

<p>Their patterns have clearly been influential on `FP`'s design.</p>

<p><code>IxJS</code>'s modular design also allows for bundle sizes to potentially be smaller (using quite different syntax).</p>

<div style="clear: both;"></div>
<h3 id='api-outline'>API Outline</h3>
<p>All <code>.then()</code>-derived methods are listed first. It&#39;s the bulk of the API.</p>

<ul>
<li><a href="#thenable-methods">Thenable Methods</a>

<ul>
<li><a href="#160-160-array-methods">Arrays</a>

<ul>
<li><code>.map(fn)</code></li>
<li><code>.filter(fn)</code></li>
<li><code>.find(fn)</code></li>
<li><code>.findIndex(fn)</code></li>
<li><code>.some(fn)</code></li>
<li><code>.none(fn)</code></li>
<li><code>.series(fn)</code></li>
<li><code>.forEach(fn)</code> - use <code>.map()</code> instead (write <em>proper</em> <code>functions</code>)</li>
</ul></li>
<li><a href="#160-160-errors">Errors</a> <em>(WIP)</em>

<ul>
<li><code>.catch(fn)</code></li>
<li><code>.catch(filter, fn)</code></li>
</ul></li>
<li><a href="#160-160-conditional">Conditional</a>

<ul>
<li><code>.thenIf()</code></li>
</ul></li>
<li><a href="#160-160-utilities">Utilities</a>

<ul>
<li><code>.tap(fn)</code></li>
</ul></li>
<li><a href="#160-160-properties">Properties</a>

<ul>
<li><code>.get(keyName)</code></li>
<li><code>.set(keyName, value)</code></li>
</ul></li>
</ul></li>
<li><a href="#specialty-methods">Specialty Methods</a>

<ul>
<li><a href="#160-160-helpers">Helpers</a>

<ul>
<li><code>FP.resolve()</code></li>
<li><code>FP.all(Object/Array)</code></li>
<li><code>FP.unpack()</code></li>
</ul></li>
<li><a href="#160-160-events">Events</a>

<ul>
<li><code>.listen(obj, ...eventNames)</code></li>
</ul></li>
<li><a href="#160-160-composition-pipelines">Composition Pipelines</a>

<ul>
<li><code>FP.chain()</code></li>
<li><code>.chainEnd()</code></li>
</ul></li>
<li><a href="#160-160-modifiers">Modifiers</a>

<ul>
<li><code>.quiet()</code> - prevents errors from stopping array methods mid-loop</li>
<li><code>.concurrency(threadLimit)</code> - limits parallel workers for array methods</li>
</ul></li>
</ul></li>
</ul>
<h1 id='thenable-methods'>Thenable Methods</h1>
<p>You can think of most <code>FP</code> methods as <strong>wrappers derived from Native Promise&#39;s <code>.then()</code>.</strong></p>

<p>For example, <code>.tap(fn)</code>&#39;s function will receive the resolved value exactly like a <code>.then()</code>. Except the function&#39;s <code>return</code> value will be ignored - and the next <code>thenable</code> in the chain will get the original input.</p>

<p>A <code>.catch()</code> is another type of <code>thenable</code>! It works because an Error in a Promise will cause it to skip or &quot;surf&quot; over <code>thenables</code> until it finds a special <code>thenable</code>: <code>.catch()</code>. It then takes that Error value and passes it into the function. <code>.catch(err=&gt;{log(err.message)})</code></p>

<p>See all <code>thenable</code> methods in <code>FP</code>: Arrays, Errors, Conditional, Utilities, Properties, etc.</p>
<h1 id='160-160-array-methods'>&#160;&#160; Array Methods</h1>
<p>Any <code>.then()</code> which would handle an array, may instead use one of the <code>FP</code> array methods.</p>
<h2 id='code-fp-map-iterable-fn-code'><code>FP.map(iterable, fn)</code></h2><pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">5</span><span class="p">)])</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
  <span class="p">})</span>
</code></pre>
<p>Similar to <code>Array.prototype.map((item[, index, array]) =&gt; {})</code>.</p>

<p><strong>Use to transforms an array of values, passing each through the given function.</strong></p>

<p>The return value will be a new array containing the result for each call to <code>fn(item)</code>.</p>

<p>For example, let&#39;s say you have to multiply a list of numbers by 2.</p>

<p>Using <code>FP.map()</code> to do this lets you focus on the important logic: <code>x =&gt; x * 2</code></p>
<h2 id='code-fp-filter-iterable-fn-code'><code>FP.filter(iterable, fn)</code></h2><pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>

<span class="c1">// Or similarly:</span>
<span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">value</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
</code></pre>
<p>Use <code>.filter()</code> to omit items from the input array by passing through a given function. Items will be omitted if the function returns a falsey value.</p>

<aside class="notice">
  The <code>Boolean</code> type can be used as a truthiness check. For example: <code>assert.equal(Boolean(1), true)</code>, <code>assert.equal(Boolean(false), false)</code>, <code>assert.equal(Boolean(null), false)</code>.
</aside>
<h2 id='code-fp-find-iterable-fn-code'><code>FP.find(iterable, fn)</code></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">isEven</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span>
<span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">isEven</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">})</span>
</code></pre>
<p>Returns first item to return truthy for <code>fn(item)</code></p>

<p>If no match is found it will return <code>undefined</code>.</p>
<h2 id='code-fp-findindex-iterable-fn-code'><code>FP.findIndex(iterable, fn)</code></h2><pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">isEven</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">})</span>
</code></pre>
<p>Returns first <strong>item&#39;s index</strong> to return truthy for <code>fn(item)</code></p>

<p>If no match is found it will return <code>-1</code>.</p>
<h2 id='code-fp-some-iterable-fn-code'><code>FP.some(iterable, fn)</code></h2><pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">isEven</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
  <span class="p">})</span>
</code></pre>
<p>Returns <code>Promise&lt;true&gt;</code> on the first <strong>item</strong> to return truthy for <code>fn(item)</code></p>

<p>If no truthy result is found, <code>.some()</code> returns <code>Promise&lt;false&gt;</code>.</p>
<h2 id='code-fp-none-iterable-fn-code'><code>FP.none(iterable, fn)</code></h2><pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">isEven</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will return true:</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
  <span class="p">})</span>
</code></pre>
<p>Returns <code>Promise&lt;false&gt;</code> on the first <strong>item</strong> to return falsey for <code>fn(item)</code></p>

<p>If no match is found it will return <code>Promise&lt;true&gt;</code>.</p>
<h1 id='160-160-conditional'>&#160;&#160; Conditional</h1><h2 id='code-fp-thenif-code'><code>FP.thenIf()</code></h2>
<p><code>.thenIf(condition(value), ifTrue(value), ifFalse(value))</code></p>

<blockquote>
<p>Use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch"><code>fetch</code></a> with <code>FP.thenIf()</code> to handle when <code>response.ok === false</code> using custom response.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Wrap `fetch`'s returned Promise with `FP.resolve()` - enables `FP`'s methods</span>
<span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/profile'</span><span class="p">,</span> <span class="p">{</span><span class="na">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">}))</span>
  <span class="p">.</span><span class="nx">thenIf</span><span class="p">(</span> <span class="c1">// thenIf lets us handle branching logic</span>
    <span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">,</span> <span class="c1">// Check if response is ok</span>
    <span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span> <span class="c1">// if true, return the parsed body</span>
    <span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">({</span><span class="na">avatar</span><span class="p">:</span> <span class="s1">'/no-photo.svg'</span><span class="p">}))</span> <span class="c1">// fail, use default object</span>
  <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'avatar'</span><span class="p">)</span> <span class="c1">// Get the resulting objects `avatar` value</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">avatarUrl</span> <span class="o">=&gt;</span> <span class="nx">imgElement</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">avatarUrl</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Email &#39;validator&#39;</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Use like so:</span>
<span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">thenIf</span><span class="p">(</span>
    <span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="c1">// Conditional</span>
    <span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Valid: '</span><span class="p">,</span> <span class="nx">e</span><span class="p">),</span> <span class="c1">// ifTrue</span>
    <span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Bad Email: '</span><span class="p">,</span> <span class="nx">e</span><span class="p">))</span> <span class="c1">// ifFalse</span>
</code></pre><h4 id='arguments'>Arguments</h4>
<ul>
<li><code>condition</code>, echo/truthy function: <code>(x) =&gt; x</code></li>
<li><code>ifTrue</code>, echo function: <code>(x) =&gt; x</code></li>
<li><code>ifFalse</code>, quiet function: <code>() =&gt; null</code></li>
</ul>

<p>The <code>condition</code> function should return either <code>true</code>/<code>false</code> or a promise that resolves to something <code>true</code>/<code>false</code>.</p>

<p><code>ifTrue</code> function is called if the <code>condition</code> resulted in a truthy value. Conversely, <code>ifFalse</code> will be called if we got a false answer.</p>

<p>The return value of either <code>ifTrue</code>/<code>ifFalse</code> handler will be handed to the next <code>.then()</code>.</p>

<p>Default values let you call <code>.thenIf</code> with no args - if you simply want to exclude falsey values down the chain.</p>

<blockquote>
<p>Functional Promise Login Flow</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Check if login successfully returned a token:</span>
<span class="kr">const</span> <span class="nx">authUser</span> <span class="o">=</span> <span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">pass</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">FP</span>
  <span class="p">.</span><span class="nx">resolve</span><span class="p">({</span><span class="nx">email</span><span class="p">,</span> <span class="nx">pass</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(({</span><span class="nx">email</span><span class="p">,</span> <span class="nx">pass</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">svc</span><span class="p">.</span><span class="nx">loginGetUser</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">pass</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">thenIf</span><span class="p">(</span>
    <span class="nx">user</span> <span class="o">=&gt;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">token</span><span class="p">,</span> <span class="c1">// is valid login</span>
    <span class="nx">user</span> <span class="o">=&gt;</span> <span class="nx">user</span><span class="p">,</span> <span class="c1">// return user to next .then function</span>
    <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Login Failed!'</span><span class="p">)}))</span>
</code></pre><h1 id='160-160-utilities'>&#160;&#160; Utilities</h1><h2 id='code-tap-fn-code'><code>.tap(fn)</code></h2>
<p>The <code>.tap()</code> method is <code>FP</code>&#39;s counterpart to <code>console.log()</code> - know it well.</p>

<p>It works just like <code>.then()</code> except it&#39;s return value is ignored. The next <code>thenable</code> will get the same input.</p>

<p>Perfect for logging or other background tasks (where results don&#39;t need to block).</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/user/42/photos'</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`user photos req ok? </span><span class="p">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">}</span><span class="s2">`</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</code></pre><h1 id='160-160-properties'>&#160;&#160; Properties</h1>
<p>These methods are particularly helpful for dealing with data extraction/transformation.</p>
<h2 id='code-fp-get-keyname-code'><code>FP.get(keyName)</code></h2>
<p>Use to get a single key&#39;s value from an object.</p>

<p>Returns the key value.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span><span class="na">foo</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="c1">// x === 42</span>
  <span class="p">})</span>
</code></pre><h2 id='code-fp-set-keyname-value-code'><code>FP.set(keyName, value)</code></h2>
<p>Use to set a single key&#39;s value on an object.</p>

<p>Returns the <strong>modified object.</strong></p>

<blockquote>
<p>A common use-case includes dropping passwords or tokens.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span><span class="na">username</span><span class="p">:</span> <span class="s1">'dan'</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="s1">'sekret'</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'password'</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">obj</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span> <span class="c1">// obj.password === undefined</span>
  <span class="p">})</span>
</code></pre><h1 id='specialty-methods'>Specialty Methods</h1><h1 id='160-160-helpers'>&#160;&#160; Helpers</h1><h2 id='code-fp-resolve-lt-anything-gt-code'><code>FP.resolve(&lt;anything&gt;)</code></h2>
<p>Turn anything into an FP Promise. Also can upgrade any Promise-supporting library.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span>
<span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">))</span>
<span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">anything</span><span class="p">))</span>
</code></pre><h2 id='code-fp-all-code'><code>FP.all()</code></h2>
<p><code>FP.all()</code> provides an extended utility above the native <code>Promise.all()</code>, <strong>supporting both Objects and Arrays.</strong></p>

<p><em>Note:</em> Non-recursive.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
  <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">])</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</code></pre>
<blockquote>
<p>Also works with keyed Objects:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">all</span><span class="p">({</span>
  <span class="na">one</span><span class="p">:</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="na">two</span><span class="p">:</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">})</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="p">{</span><span class="na">one</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">two</span><span class="p">:</span> <span class="mi">2</span><span class="p">}))</span>
</code></pre><h2 id='code-fp-unpack-code'><code>FP.unpack()</code></h2><pre class="highlight javascript tab-javascript"><code><span class="kd">function</span> <span class="nx">edgeCase</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">promise</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">FP</span><span class="p">.</span><span class="nx">unpack</span><span class="p">()</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">resolve</span><span class="p">(</span><span class="s1">'All done!'</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">promise</span>
<span class="p">}</span>

<span class="nx">edgeCase</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="s1">'All done!'</span><span class="p">))</span>
</code></pre>
<p>Use sparingly. Stream &amp; event handling are exempt from this &#39;rule&#39;. If using ES2015, destructuring helps to (more cleanly) achieve what <code>deferred</code> attempts.</p>

<p><code>deferred</code> is an anti-pattern because it works against simple composition chains.</p>
<h1 id='160-160-events'>&#160;&#160; Events</h1>
<p>Promises can be awkward when dealing with events.</p>
<h4 id='code-functional-promise-code-library-aims-to-find-a-harmonious-pattern'><code>Functional Promise</code> library aims to find a harmonious pattern.</h4><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'submitBtn'</span><span class="p">)</span>
<span class="nx">FP</span><span class="p">.</span><span class="nx">chain</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'target'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">element</span> <span class="o">=&gt;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s1">'Clicked!'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">button</span><span class="p">,</span> <span class="s1">'click'</span><span class="p">)</span>
</code></pre>
<p>Key considerations:</p>

<p>Let&#39;s start with their <strong>similarities</strong>, both are (essentially) async...</p>

<p>And now for some <strong>differences</strong>:</p>

<ul>
<li>Promises are single-execution cached values. Events can run many times per second with different arguments or data.</li>
<li>Events have control flow to think about (<code>e.preventDefault()</code>). Promises flow in one direction.</li>
<li>Promises depend on <code>return</code>&#39;s everywhere. Event handlers which <code>return</code> may cause unexpected control-flow issues.</li>
</ul>

<p><em>Yikes.</em></p>

<p>Let&#39;s look at some code &amp; see how <code>FP</code> solves this...</p>
<h2 id='code-listen-code-event-helper'><code>.listen()</code> event helper</h2>
<p>The <code>.listen()</code> method must be called after an <code>FP.chain()</code> sequence of <code>FP</code> methods.</p>

<p><strong>Note:</strong> The <code>.chainEnd()</code> method is automatically called.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">chain</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'target'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'textContent'</span><span class="p">,</span> <span class="s1">'Clicked!'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">button</span><span class="p">,</span> <span class="s1">'click'</span><span class="p">)</span>
</code></pre><h1 id='160-160-composition-pipelines'>&#160;&#160; Composition Pipelines</h1>
<blockquote>
<p><em>Non <code>.then()</code>-based Methods</em></p>
</blockquote>

<aside class="notice">
  <i>Forgive me Haskell people, but I'm calling this a monad.</i>
</aside>

<p>Chained Functional Promises unlock a powerful technique: <strong>Reusable Async Composition Pipelines.</strong></p>

<p><strong>Enough jargon!</strong> <em>Let&#39;s rock some examples:</em></p>

<!-- **Examples and usage patterns below:** -->
<h2 id='code-chain-code-code-chainend-code'><code>.chain()</code> / <code>.chainEnd()</code></h2>
<blockquote>
<p>Both <code>.chain()</code> and <code>.chainEnd()</code> must be used together.</p>
</blockquote>

<p><code>FP.chain()</code> is a static method on <code>FP</code>. Any</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">getTarget</span> <span class="o">=</span> <span class="nx">FP</span>
  <span class="p">.</span><span class="nx">chain</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'target'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">chainEnd</span><span class="p">()</span>

<span class="nx">getTarget</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">target</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Event target: '</span><span class="p">,</span> <span class="nx">target</span><span class="p">)})</span>
</code></pre><h2 id='re-usable-promise-chains'>Re-usable Promise Chains</h2>
<p>Create a re-usable sequence of steps:</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">squareAndFormatDecimal</span> <span class="o">=</span> <span class="nx">FP</span>
  <span class="p">.</span><span class="nx">chain</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">chainEnd</span><span class="p">()</span>

<span class="nx">squareAndFormatDecimal</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">num</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'squareAndFormatDecimal() Results: '</span><span class="p">,</span> <span class="nx">num</span><span class="p">)</span>
  <span class="c1">// num === ['25.00']</span>
<span class="p">})</span>

</code></pre><h2 id='events-promise-chain'>Events + Promise Chain</h2><pre class="highlight javascript tab-javascript"><code><span class="kd">function</span> <span class="nx">addTodoHandler</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">statusLbl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'label.status'</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">setStatus</span> <span class="o">=</span> <span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">statusLbl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">s</span>
  <span class="kr">const</span> <span class="nx">setError</span>  <span class="o">=</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">setStatus</span><span class="p">(</span><span class="s2">`ERROR: </span><span class="p">${</span><span class="nx">err</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>

  <span class="k">return</span> <span class="nx">FP</span>
    <span class="p">.</span><span class="nx">chain</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">event</span> <span class="o">=&gt;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">form</span> <span class="o">=&gt;</span> <span class="nx">form</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'input.todo-text'</span><span class="p">).</span><span class="nx">value</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">todoText</span> <span class="o">=&gt;</span> <span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="na">complete</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nx">todoText</span><span class="p">}))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">todoAPI</span><span class="p">.</span><span class="nx">create</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">createResult</span> <span class="o">=&gt;</span> <span class="nx">setStatus</span><span class="p">(</span><span class="nx">createResult</span><span class="p">.</span><span class="nx">message</span><span class="p">))</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">setError</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">chainEnd</span><span class="p">()</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'form'</span><span class="p">)</span>
<span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'submit'</span><span class="p">,</span> <span class="nx">addTodoHandler</span><span class="p">())</span>
</code></pre><h2 id='controller-events-promise-chain'>Controller + Events + Promise Chain</h2>
<p>A more realistic &#39;class&#39; like object.</p>

<p>Again, still all with simple functions:</p>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// using a more complete controller/component interface:</span>
<span class="kr">const</span> <span class="nx">todoCtrl</span> <span class="o">=</span> <span class="nx">TodoController</span><span class="p">()</span>

<span class="nx">todoCtrl</span>
  <span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'new item'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">todoCtrl</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="s1">'updated item'</span><span class="p">,</span> <span class="na">complete</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
  <span class="p">})</span>

<span class="cm">/**
 * Here's a more realistic, 'tighter' example:
 * TodoController will return an object with `add` and `update` methods
 *  - based on FP.chain()
 */</span>
<span class="kd">function</span> <span class="nx">TodoController</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">statusLbl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'label.status'</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">setStatus</span> <span class="o">=</span> <span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">statusLbl</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">s</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">add</span><span class="p">:</span> <span class="nx">FP</span><span class="p">.</span><span class="nx">chain</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">input</span> <span class="o">=&gt;</span> <span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="na">complete</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span> <span class="nx">input</span><span class="p">}))</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">todoAPI</span><span class="p">.</span><span class="nx">create</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">createResult</span> <span class="o">=&gt;</span> <span class="nx">setStatus</span><span class="p">(</span><span class="nx">createResult</span><span class="p">.</span><span class="nx">message</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">chainEnd</span><span class="p">(),</span>
    <span class="na">update</span><span class="p">:</span> <span class="nx">FP</span><span class="p">.</span><span class="nx">chain</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">input</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span><span class="nx">id</span><span class="p">,</span> <span class="nx">complete</span><span class="p">,</span> <span class="nx">text</span><span class="p">}</span> <span class="o">=</span> <span class="nx">input</span>
        <span class="k">return</span> <span class="p">{</span><span class="nx">id</span><span class="p">,</span> <span class="nx">complete</span><span class="p">,</span> <span class="nx">text</span><span class="p">}</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">todoAPI</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">updateResult</span> <span class="o">=&gt;</span> <span class="nx">setStatus</span><span class="p">(</span><span class="nx">updateResult</span><span class="p">.</span><span class="nx">message</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">chainEnd</span><span class="p">(),</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre><h1 id='160-160-modifiers'>&#160;&#160; Modifiers</h1><h2 id='code-quiet-code'><code>.quiet()</code></h2><pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">quiet</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="mi">2</span> <span class="o">/</span> <span class="nx">x</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">Error</span><span class="p">])</span>
  <span class="p">})</span>
</code></pre>
<p>Suppresses errors by converting them to return values.</p>

<p><strong>Only applies to subsequent thenable.</strong></p>

<p>Best used with Array methods.</p>
<h2 id='code-concurrency-threadlimit-code'><code>.concurrency(threadLimit)</code></h2><pre class="highlight javascript tab-javascript"><code><span class="nx">FP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">concurrency</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
  <span class="p">})</span>
</code></pre>
<p>Set <code>threadLimit</code> to constrain the amount of simultaneous tasks/promises can run.</p>

<p><strong>Only applies to subsequent Array thenable.</strong></p>

<p><em>Best used with Array methods.</em></p>

<blockquote>
<p>Thanks to several influencial projects: RxJS, Bluebird, asynquence, FantasyLand, Gulp, HighlandJS, et al.</p>
</blockquote>

      </div>
      <div class="dark-box">
      </div>
    </div>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-112472862-1');
    </script>

  </body>
</html>
